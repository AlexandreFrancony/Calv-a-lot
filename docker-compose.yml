# Calv-a-lot - Copy-Trading Follower pour Cash-a-lot
# Suit les d√©cisions de trading de Cash-a-lot via polling
#
# Usage:
#   docker compose up -d
#
# First-time setup: open http://IP:8080 in your browser.
# Config is saved to ./data/config.json and persists across restarts.
#
# For same-server deployment with Cash-a-lot, create a
# docker-compose.override.yml to add the shared network (see README).

services:
  follower:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        GIT_COMMIT: ${GIT_COMMIT:-unknown}
    container_name: calvalot
    restart: unless-stopped
    security_opt:
      - no-new-privileges:true
    cap_drop:
      - ALL
    environment:
      TZ: Europe/Paris
      LEADER_URL: ${LEADER_URL:-}
      SIGNAL_SECRET: ${SIGNAL_SECRET:-}
      BINANCE_API_KEY: ${BINANCE_API_KEY:-}
      BINANCE_API_SECRET: ${BINANCE_API_SECRET:-}
      BINANCE_TESTNET: ${BINANCE_TESTNET:-false}
      TRADING_MODE: ${TRADING_MODE:-dry_run}
      INITIAL_BUDGET_EUR: ${INITIAL_BUDGET_EUR:-100}
      POLL_INTERVAL_SECONDS: ${POLL_INTERVAL_SECONDS:-120}
      SMTP_HOST: ${SMTP_HOST:-}
      SMTP_PORT: ${SMTP_PORT:-465}
      SMTP_USER: ${SMTP_USER:-}
      SMTP_PASSWORD: ${SMTP_PASSWORD:-}
      ALERT_EMAIL_TO: ${ALERT_EMAIL_TO:-}
      API_USER: ${API_USER:-admin}
      API_PASSWORD_HASH: ${API_PASSWORD_HASH:-}
      PORT: 8080
    ports:
      - "8080:8080"
    volumes:
      - ./data:/app/data
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/health"]
      interval: 120s
      timeout: 5s
      retries: 3
      start_period: 30s
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
    deploy:
      resources:
        limits:
          memory: 192M
